Podman Compatibility
====================

Kolla Ansible supports deployments with Podman.  Podman 4.9 renamed
some fields returned by ``podman inspect``.  ``PidMode`` became
``PidNS`` and ``CgroupnsMode`` became ``CgroupNS``.  Kolla Ansible now
accepts either name when comparing containers and passes the correct
``--pid`` and ``--cgroupns`` options to ``podman`` when creating
containers.

When using ``*_extra_volumes`` options, Kolla Ansible will automatically
create any missing host directories referenced by bind mounts with
permissions ``0755`` before starting containers.

Sequential container start
--------------------------

Systemd unit files generated by Podman use the naming pattern
``container-<name>.service``.  The ``service-start-order`` role installs
``After=`` and ``Requires=`` directives for these units so that services
start sequentially according to ``kolla_service_start_priority``.  This
ensures dependencies such as databases and messaging back ends are
available before the corresponding API services are launched.

One-shot cleanup containers
---------------------------

Cleanup containers like ``neutron_ovs_cleanup`` are started as normal
services.  They run at boot and create a marker file
``/tmp/kolla/neutron_ovs_cleanup/done`` so subsequent starts skip the
container until the host reboots.
