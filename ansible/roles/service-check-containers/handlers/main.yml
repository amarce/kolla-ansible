---
- name: Attempt runtime restart first
  listen: Restart container
  become: true
  command: "{{ kolla_container_engine }} restart {{ container_name }}"
  register: runtime_restart
  failed_when: false
  changed_when: runtime_restart.rc == 0

- name: Ensure unit enabled
  listen: Restart container
  become: true
  systemd:
    name: "{{ unit_name }}"
    enabled: true
  when: runtime_restart.rc != 0

- name: Restart unit as fallback
  listen: Restart container
  become: true
  systemd:
    name: "{{ unit_name }}"
    state: restarted
  when: runtime_restart.rc != 0
