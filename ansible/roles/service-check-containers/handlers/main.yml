---
- name: Process queued service-check actions
  listen: Process service-check actions
  vars:
    pending_actions: "{{ service_check_pending_actions | default([]) }}"
  when: pending_actions | length > 0
  block:
    - name: Handle queued service-check action for {{ action.container_name }}
      vars:
        handler_context: "{{ action }}"
      include_tasks: process_action.yml
      loop: "{{ pending_actions }}"
      loop_control:
        loop_var: action
    - name: Clear processed service-check actions
      set_fact:
        service_check_pending_actions: []
