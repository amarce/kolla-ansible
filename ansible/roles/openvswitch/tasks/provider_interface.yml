---
- name: Skip provider interface attachment for empty bridge name
  debug:
    msg: "Skipping provider interface mapping because the bridge name is empty"
    verbosity: 1
  when: provider_bridge | default('') | length == 0

- name: Manage provider interface {{ provider_port | default('') }} on bridge {{ provider_bridge }}
  when: provider_bridge | default('') | length > 0
  block:
    - name: Skip provider interface attachment when no interface is defined
      debug:
        msg: "No external interface defined for provider bridge {{ provider_bridge }}"
        verbosity: 1
      when: provider_port | default('') | length == 0

    - name: Guard against attaching provider bridge {{ provider_bridge }} to itself
      debug:
        msg: >-
          Skipping provider port attachment because the external interface "{{ provider_port }}" resolves to the bridge name "{{ provider_bridge }}"
        warn: true
      when:
        - provider_port | default('') | length > 0
        - provider_bridge == provider_port

    - name: Manage provider interface {{ provider_port }} attachment
      when:
        - provider_port | default('') | length > 0
        - provider_bridge != provider_port
      block:
        - name: Enforce provider interface {{ provider_port }} bridge membership
          include_tasks: provider_interface_attach.yml

        - name: Reconcile provider interface {{ provider_port }} options
          include_tasks: provider_interface_options.yml
          when: provider_interface_reconcile_options | default(false) | bool
